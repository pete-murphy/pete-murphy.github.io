<!DOCTYPE html>
<html lang="en">
  <head profile="http://www.w3.org/2005/10/profile">
    <meta charset="UTF-8" />
    <meta name="description" content="TIL" />
    <meta name="author" content="Me" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">
        <title></title>
    <link rel="stylesheet" href="/css/main.css" />
  </head>
  <body>
    <header class="nav-header">
      <nav>
        <a href="/" aria-label="Home">
              <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="currentColor"
      class="icon"
    >
      <path
        d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z"
      />
      <path
        d="M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z"
      />
    </svg>
<span>Home</span>
        </a>
      </nav>
    
      <!-- <div class="right-sidebar">
            <a class="ext-link" href="https://github.com/ptrfrncsmrph">
            <img src="/images/github-logo.png" alt="Github Profile"/>
        </a>

        <div id="theme-button">DAY</div>
        </div> -->
    </header>

    <main>
      <header>

        <section class="post">
          <div class="inline-container">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="icon"
            >
              <path
                fill-rule="evenodd"
                d="M6.75 2.25A.75.75 0 017.5 3v1.5h9V3A.75.75 0 0118 3v1.5h.75a3 3 0 013 3v11.25a3 3 0 01-3 3H5.25a3 3 0 01-3-3V7.5a3 3 0 013-3H6V3a.75.75 0 01.75-.75zm13.5 9a1.5 1.5 0 00-1.5-1.5H5.25a1.5 1.5 0 00-1.5 1.5v7.5a1.5 1.5 0 001.5 1.5h13.5a1.5 1.5 0 001.5-1.5v-7.5z"
                clip-rule="evenodd"
              />
            </svg>
            <time datetime="2023-05-17T00:00:00Z">May 17, 2023</time>
          </div>
          <div class="tags-container inline-container">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="icon"
            >
              <path
                fill-rule="evenodd"
                d="M5.25 2.25a3 3 0 00-3 3v4.318a3 3 0 00.879 2.121l9.58 9.581c.92.92 2.39 1.186 3.548.428a18.849 18.849 0 005.441-5.44c.758-1.16.492-2.629-.428-3.548l-9.58-9.581a3 3 0 00-2.122-.879H5.25zM6.375 7.5a1.125 1.125 0 100-2.25 1.125 1.125 0 000 2.25z"
                clip-rule="evenodd"
              />
            </svg>
            <ul class="tags">
              <li class="tag react">react</li>
              <li class="tag react-router">react-router</li>
              <li class="tag view transitions">view transitions</li>
            </ul>
          </div>

          <h1>Experimenting with View Transitions API in React</h1>
        </section>
      </header>

      <article class="post"><p>Recently I wanted to implement something like what Material UI calls
the <a
href="https://m3.material.io/styles/motion/transitions/transition-patterns#b67cba74-6240-4663-a423-d537b6d21187">container
transform pattern</a>. From the Material 3 docs:</p>
<blockquote>
<p>This pattern is used to seamlessly transform an element to show more
detail, like a card expanding into a details page. […] Persistent
elements are used to seamlessly connect the start and end state of the
transition.</p>
</blockquote>
<p>Here’s a simple example in a GIF</p>
<p><img src="../images/2023-05-21-container-transform.gif" /></p>
<p>The pattern isn’t unique to Material or Google, it’s used for example
in iOS when opening an app from the home screen. Can’t really speak on
how easy this is to implement on mobile, but on the web the
implementation has historically been complicated by the variety of
layout rules that need to be taken into account (Cassie Evans has an
excellent <a href="https://www.youtube.com/watch?v=POBxxUkvHi4">talk
about the difficulties involved here</a>.)</p>
<p>The solution that folks seem to have landed on for this is the <a
href="https://aerotwist.com/blog/flip-your-animations/">FLIP
technique</a>. It’s a magic trick that’s made a bit of sense of when you
consider that (on the web) it’s most natural to specify the beginning
and end states of an animation, and the start time (usually at the
moment of some user event). There are some high-level libraries for
creating this effect (for example, in React I think the thing to use
would be <a
href="https://www.framer.com/motion/layout-group/"><code>LayoutGroup</code></a>
from <code>framer/motion</code>.)</p>
<h2 id="view-transitions-api">View Transitions API</h2>
<p>There’s a new browser API for this though in the <a
href="https://developer.mozilla.org/en-US/docs/Web/API/View_Transitions_API">View
Transitions API</a>. This is still a <a
href="https://drafts.csswg.org/css-view-transitions-1/">draft
specification</a> at time of writing, but it’s landed in Chrome.</p>
<h3 id="minimal-demo-using-transitions-between-routes">Minimal demo
using transitions between routes</h3>
<p><img
src="https://github.com/ptrfrncsmrph/react-view-transitions-api/assets/26548438/ac3b1eb0-b2af-49ca-a315-79346f8cb7ab" /></p>
<p>After a bit of trial-and-error I got a demo working using animated
transitions between routes with React Router. Here’s the repo: <a
href="https://github.com/ptrfrncsmrph/react-view-transitions-api">https://github.com/ptrfrncsmrph/react-view-transitions-api</a>.</p>
<p>One rough bit: I ended up using <code>useNavigate</code> and a button
with a click handler (instead of <code>Link</code>) and wrapping the
call to <code>navigate</code> in <code>flushSync</code>. This is
necessary to force navigation change (and subsequent DOM updates) to
happen within the scope of the callback passed to
<code>startViewTransition</code>.</p>
<p>There ends up being this nesting of “effects”</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="fu">startViewTransition</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  ReactDOM<span class="op">.</span><span class="fu">flushSync</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">navigate_</span>(nextRoute)<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The React docs warn that <code>flushSync</code> should be used as a
“last resort”. Not sure of an alternative here, at the least maybe the
<code>startViewTransition</code> call could be abstracted away into the
router library code.</p>
<p>Another awkward bit</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">event</span><span class="op">.</span><span class="at">currentTarget</span><span class="op">.</span><span class="at">firstElementChild</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">viewTransitionName</span> <span class="op">=</span> <span class="st">&quot;image-test&quot;</span><span class="op">;</span></span></code></pre></div>
<p>The more “idiomatic” thing in React would be to move each of the
movie list items into a component that can call <code>useRef</code> to
do that assignment, but really the underlying issue is that there needs
to be exactly one element with the <code>"image-test"</code> transition
name at any given time, so <a
href="https://developer.chrome.com/docs/web-platform/view-transitions/#transitioning-elements-dont-need-to-be-the-same-dom-element">the
solution</a> seems to be <em>assign the tag name on user interaction
(click)</em>. I wanted to give unique names to each element (like</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>viewTransitionName<span class="op">:</span> <span class="vs">`image-test-</span><span class="sc">${</span>movie<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div>
<p>), but that would have required creating just as many rules in the
style sheet as there are elements (at the time there doesn’t seem to be
a way of selecting <code>::view-transition-group(image-test-*)</code> or
similar, though that would be ideal.)</p></article>
    </main>

    <footer>
      Built with Haskell using
      <a href="https://github.com/ChrisPenner/slick">slick</a>️ (&
      <a href="https://open-props.style/">open-props</a>️ & web components)
    </footer>
    
    <script src="/js/main.js"></script>

    <script src="/js/multicodeblock-tabs.js"></script>
  </body>
</html>
